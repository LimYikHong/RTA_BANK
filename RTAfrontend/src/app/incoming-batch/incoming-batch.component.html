<div class="page-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2>RTA Upload</h2>
    <ul>
      <li routerLink="/batch-list" routerLinkActive="active"><b>Upload Batch File</b></li>
      <li routerLink="/incoming-batch" routerLinkActive="active"><b>Incoming Batch File</b></li>
      <li routerLink="/profile" routerLinkActive="active">View Profile</li>
      <li routerLink="/users" routerLinkActive="active"><b>User Management</b></li>
      <li routerLink="/merchant-maintenance" routerLinkActive="active"><b>Merchant Maintenance</b></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <button class="logout-btn" (click)="logout()">Logout</button>
  <main class="main-content">
    <div class="page-header">
      <h1>Incoming Batch Files</h1>
      <p class="subtitle">Files received from merchant applications via HTTPS.</p>
    </div>

    <!-- Search & Refresh -->
    <div class="toolbar">
      <input type="text" class="search-input" placeholder="Search by filename, merchant ID, status..."
        [(ngModel)]="searchTerm" (ngModelChange)="onSearch()" />
      <button class="btn btn-refresh" (click)="loadIncomingFiles()">Refresh</button>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="loading-text">Loading incoming files...</div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && filteredFiles.length === 0" class="empty-state">
      <p>No incoming batch files found.</p>
    </div>

    <!-- Table -->
    <div class="table-wrapper" *ngIf="!isLoading && filteredFiles.length > 0">
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>File Name</th>
            <th>Merchant ID</th>
            <th>Batch ID</th>
            <th>Size</th>
            <th>Status</th>
            <th>Records</th>
            <th>Created By</th>
            <th>Created At</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let file of filteredFiles">
            <td>{{ file.batchFileId }}</td>
            <td class="filename-cell">{{ file.originalFilename || '-' }}</td>
            <td>{{ file.merchantId }}</td>
            <td>{{ file.batchId }}</td>
            <td>{{ formatBytes(file.sizeBytes) }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(file.fileStatus)">
                {{ file.fileStatus || '-' }}
              </span>
            </td>
            <td>
              <span *ngIf="file.totalRecordCount != null">
                {{ file.totalRecordCount }}
                <span class="record-detail" *ngIf="file.successCount != null">
                  ({{ file.successCount }}✓ / {{ file.failCount || 0 }}✗)
                </span>
              </span>
              <span *ngIf="file.totalRecordCount == null">-</span>
            </td>
            <td>{{ file.createBy || '-' }}</td>
            <td>{{ file.createdAt ? (file.createdAt | date: 'short') : '-' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>
