<div class="page-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2>RTA Upload</h2>
    <ul>
      <li routerLink="/batch-list" routerLinkActive="active"><b>Upload Batch File</b></li>
      <li routerLink="/incoming-batch" routerLinkActive="active"><b>Incoming Batch File</b></li>
      <li routerLink="/profile" routerLinkActive="active">View Profile</li>
      <li routerLink="/users" routerLinkActive="active"><b>User Management</b></li>
      <li routerLink="/merchant-maintenance" routerLinkActive="active"><b>Merchant Maintenance</b></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <button class="logout-btn" (click)="logout()">Logout</button>
  <main class="main-content">
    <div class="page-header">
      <button class="back-btn" routerLink="/merchant-maintenance">&lt; Back to Merchants</button>
      <h1>Add New Merchant</h1>
      <p class="subtitle">Fill in the details below to create a new merchant. This will publish a Kafka event to notify all sub-systems.</p>
    </div>

    <div class="form-card">
      <form #addMerchantForm="ngForm" (ngSubmit)="saveMerchant()">

        <!-- Merchant Identity -->
        <div class="form-section">
          <h3>Merchant Identity</h3>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="merchantId">Merchant ID <span class="required">*</span></label>
              <input type="text" id="merchantId" class="form-input id-readonly" [(ngModel)]="merchant.merchantId"
                name="merchantId" placeholder="Auto-generated" required readonly />
              <span class="field-info" *ngIf="isLoadingId">Generating ID...</span>
              <span class="field-info" *ngIf="!isLoadingId">Auto-generated (read-only)</span>
            </div>
            <div class="form-group">
              <label class="form-label" for="name">Name <span class="required">*</span></label>
              <input type="text" id="name" class="form-input" [(ngModel)]="merchant.name"
                name="name" placeholder="Enter merchant name" required (ngModelChange)="onMerchantNameChange()" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="username">Username <span class="required">*</span></label>
              <input type="text" id="username" class="form-input" [(ngModel)]="merchant.username"
                name="username" placeholder="Enter username" required />
            </div>
            <div class="form-group">
              <label class="form-label" for="password">Password <span class="required">*</span></label>
              <input type="password" id="password" class="form-input" [(ngModel)]="merchant.password"
                name="password" placeholder="Enter password" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="email">Email <span class="required">*</span></label>
              <input type="email" id="email" class="form-input" [(ngModel)]="merchant.email"
                name="email" placeholder="Enter email address" required />
            </div>
            <div class="form-group">
              <label class="form-label" for="company">Company <span class="required">*</span></label>
              <input type="text" id="company" class="form-input" [(ngModel)]="merchant.company"
                name="company" placeholder="Enter company name" required />
            </div>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="form-section">
          <h3>Contact Information</h3>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="contact">Contact Person <span class="required">*</span></label>
              <input type="text" id="contact" class="form-input" [(ngModel)]="merchant.contact"
                name="contact" placeholder="Enter contact person name" required />
            </div>
            <div class="form-group">
              <label class="form-label" for="phone">Phone Number <span class="required">*</span></label>
              <input type="text" id="phone" class="form-input" [(ngModel)]="merchant.phone"
                name="phone" placeholder="Enter phone number" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group full-width">
              <label class="form-label" for="address">Address <span class="required">*</span></label>
              <input type="text" id="address" class="form-input" [(ngModel)]="merchant.address"
                name="address" placeholder="Enter merchant address" required />
            </div>
          </div>
        </div>

        <!-- Bank Account Information -->
        <div class="form-section">
          <h3>Bank Account Information</h3>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="merchantAccNum">Account Number <span class="required">*</span></label>
              <input type="text" id="merchantAccNum" class="form-input" [(ngModel)]="merchant.merchantAccNum"
                name="merchantAccNum" placeholder="Enter account number" required />
            </div>
            <div class="form-group">
              <label class="form-label" for="merchantAccName">Account Name <span class="required">*</span></label>
              <input type="text" id="merchantAccName" class="form-input" [(ngModel)]="merchant.merchantAccName"
                name="merchantAccName" placeholder="Auto-filled from Merchant Name" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="transactionCurrency">Transaction Currency <span class="required">*</span></label>
              <select id="transactionCurrency" class="form-input" [(ngModel)]="merchant.transactionCurrency" name="transactionCurrency" required>
                <option value="MYR">MYR</option>
                <option value="USD">USD</option>
                <option value="SGD">SGD</option>
                <option value="EUR">EUR</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="settlementCurrency">Settlement Currency <span class="required">*</span></label>
              <select id="settlementCurrency" class="form-input" [(ngModel)]="merchant.settlementCurrency" name="settlementCurrency" required>
                <option value="MYR">MYR</option>
                <option value="USD">USD</option>
                <option value="SGD">SGD</option>
                <option value="EUR">EUR</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-cancel" (click)="cancel()">Cancel</button>
          <button type="submit" class="btn btn-submit"
            [disabled]="isSubmitting || !addMerchantForm.valid || isLoadingId">
            {{ isSubmitting ? 'Creating...' : 'Create Merchant' }}
          </button>
        </div>
      </form>
    </div>
  </main>
</div>
