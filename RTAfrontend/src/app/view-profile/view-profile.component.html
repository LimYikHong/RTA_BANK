<div class="profile-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2>RTA Merchant Upload</h2>
    <ul>
      <li routerLink="/batch-list" routerLinkActive="active">
        <b>Upload Batch File</b>
      </li>
      <li routerLink="/profile" routerLinkActive="active">View Profile</li>
    </ul>
  </aside>

  <!-- Profile Content -->
  <button class="logout-btn" (click)="logout()">Logout</button>
  <main class="profile-content" *ngIf="profile; else loading">
    <div class="profile-header">
      <div class="avatar" (click)="openPhotoUpload()">
        <img
          *ngIf="profile.profilePhotoUrl"
          [src]="'http://localhost:8088' + profile.profilePhotoUrl"
          alt="Profile Photo"
          class="profile-photo"
        />
        <span *ngIf="!profile.profilePhotoUrl">{{
          profile.name.charAt(0)
        }}</span>
        <div class="edit-overlay">
          <i class="fas fa-pencil-alt"></i>
        </div>
        <input
          type="file"
          #fileInput
          style="display: none"
          (change)="onFileSelected($event)"
          accept="image/*"
        />
      </div>
      <div class="header-info">
        <h1>{{ profile.name }}</h1>
        <p class="email">{{ profile.email }}</p>
        <button class="edit-btn" (click)="openEditModal()">
          Edit Profile
        </button>
      </div>
    </div>

    <div class="profile-details">
      <h2>Profile Information</h2>
      <div class="details-grid">
        <div class="detail-item">
          <label>Merchant ID:</label><span>{{ profile.merchantId }}</span>
        </div>
        <div class="detail-item">
          <label>Company:</label><span>{{ profile.company }}</span>
        </div>
        <div class="detail-item">
          <label>Contact Number:</label><span>{{ profile.contact }}</span>
        </div>
        <div class="detail-item">
          <label>Joined On:</label><span>{{ profile.joinedOn }}</span>
        </div>
        <div class="detail-item">
          <label>Address:</label><span>{{ profile.address }}</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Loading -->
  <ng-template #loading>
    <div class="loading-text">Loading profile...</div>
  </ng-template>
</div>

<!-- Edit Modal -->
<div
  class="modal fade"
  id="editProfileModal"
  tabindex="-1"
  aria-labelledby="editProfileModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>

      <div class="modal-body">
        <form #editForm="ngForm">
          <div class="mb-3">
            <label class="form-label">Company</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="editData.company"
              name="company"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Contact Number</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="editData.contact"
              name="contact"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Address</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="editData.address"
              name="address"
              required
            />
          </div>

          <div class="mb-3" *ngIf="previewUrl">
            <label class="form-label">Profile Photo</label>
            <div class="photo-preview">
              <img [src]="previewUrl" alt="Preview" class="img-thumbnail" />
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="updateProfile()"
        >
          Save Changes
        </button>
      </div>
    </div>
  </div>
</div>